---
import BaseLayout from "../layouts/BaseLayout.astro";
import { loadBudgetData } from "@/lib/data-loader";
import { formatCurrency } from "@/lib/format";

const data = await loadBudgetData("city-of-chicago", "fy2025");
const totalBudget = data.metadata.total_appropriations;
const departmentCount = data.appropriations.by_department.length;
const fiscalYear = data.metadata.fiscal_year_label;
---

<BaseLayout
  title="Home"
  description={`Explore and simulate Chicago's ${formatCurrency(totalBudget)} operating budget`}
>
  <div class="max-w-4xl mx-auto">
    <!-- Hero Section -->
    <section class="text-center py-12">
      <h1 class="text-5xl font-bold text-gray-900 mb-4">
        Where does Chicago spend {formatCurrency(totalBudget)}?
      </h1>
      <p class="text-xl text-gray-600 mb-8">
        Explore the City's budget interactively. Simulate changes. Understand trade-offs.
      </p>
      <div class="flex gap-4 justify-center">
        <a href="/entity/city-of-chicago" class="btn-primary">
          Explore the Budget
        </a>
        <a href="/entity/city-of-chicago/simulate" class="btn-secondary">
          Try the Simulator
        </a>
      </div>
    </section>

    <!-- Quick Stats -->
    <section class="py-12 border-t border-gray-200">
      <h2 class="text-3xl font-bold text-center mb-8">Quick Facts</h2>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="bg-white p-6 rounded-lg shadow">
          <div class="text-4xl font-bold text-chicago-blue mb-2">{formatCurrency(totalBudget)}</div>
          <div class="text-gray-600">Total Operating Budget ({fiscalYear})</div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <div class="text-4xl font-bold text-chicago-blue mb-2">{departmentCount}</div>
          <div class="text-gray-600">City Departments</div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <div class="text-4xl font-bold text-chicago-blue mb-2">100%</div>
          <div class="text-gray-600">Open Source & Free</div>
        </div>
      </div>
    </section>

    <!-- About Preview -->
    <section class="py-12 border-t border-gray-200">
      <h2 class="text-3xl font-bold mb-6">What is this?</h2>
      <div class="prose max-w-none">
        <p class="text-lg text-gray-700 mb-4">
          The Chicago Budget Explorer is the <strong>only free, open, interactive tool</strong> for
          exploring the City of Chicago's operating budget. Built by Strong Towns Chicago, it makes
          budget data transparent and accessible.
        </p>
        <p class="text-gray-700 mb-4">
          Unlike read-only dashboards, you can <strong>simulate budget changes</strong> to understand
          trade-offs. Want to know what happens if you increase public safety funding while reducing
          administrative costs? Try it yourself.
        </p>
        <div class="mt-6">
          <a href="/about" class="btn-link">
            Learn more about this project →
          </a>
        </div>
      </div>
    </section>

    <!-- Entity Preview (Coming Soon) -->
    <section class="py-12 border-t border-gray-200">
      <h2 class="text-3xl font-bold mb-6">Explore Other Entities</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <!-- City of Chicago (Active) -->
        <a
          href="/entity/city-of-chicago"
          class="block bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow border-2 border-transparent hover:border-chicago-blue"
        >
          <div class="mb-4">
            <h3 class="text-xl font-bold mb-2">City of Chicago</h3>
            <span class="inline-block px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold rounded">
              Active
            </span>
          </div>
          <p class="text-gray-600 text-sm">
            {formatCurrency(totalBudget)} operating budget · FY2025 & FY2024 available
          </p>
        </a>

        <!-- Chicago Public Schools (Coming Soon) -->
        <div class="block bg-gray-100 p-6 rounded-lg shadow opacity-60">
          <div class="mb-4">
            <h3 class="text-xl font-bold mb-2">Chicago Public Schools</h3>
            <span class="inline-block px-3 py-1 bg-gray-300 text-gray-700 text-sm font-semibold rounded">
              Coming Soon
            </span>
          </div>
          <p class="text-gray-600 text-sm">
            Planned for v2.0
          </p>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>
